<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Isaac Li">
<meta property="og:url" content="http://Isaac-Li.github.io/index.html">
<meta property="og:site_name" content="Isaac Li">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Isaac Li">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://Isaac-Li.github.io/"/>





  <title>Isaac Li</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Isaac Li</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">码农 + 测试</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/19/Java-并发编程之美学习笔记之基础篇二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/19/Java-并发编程之美学习笔记之基础篇二/" itemprop="url">Java 并发编程之美学习笔记之基础篇二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-19T16:39:00+08:00">
                2018-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p><img src="/2018/12/19/Java-并发编程之美学习笔记之基础篇二/images/pasted-98.png" alt="upload successful"></p>
<p>多线程或并发编程是Java体系中的重点和难点，新购入 《Java 并发编程之美》，本博以笔记的形式记录知识要点。</p>
<hr>
<p><strong> Java 中共享变量的内存可见性问题</strong></p>
<p>Java 内存模型规定，将所有的变量都存放在主内存中，当线程使用变量时，会把主内存里面的变量复制到自己的工作空间或者叫工作内存，线程读写变量时操作的是自己工作内存中的变量。</p>
<h4 id="Synchronized-关键字"><a href="#Synchronized-关键字" class="headerlink" title="Synchronized 关键字"></a>Synchronized 关键字</h4><p>Synchronized 块是 Java 提供的一种原子性内置锁，Java 中的每个对象都可以把它当作一个同步锁来使用。</p>
<p>Synchronized 的使用会导致上下文切换。</p>
<p><strong>Synchronized 块的内存语义</strong>是把在 Synchronized 块内使用到的变量从线程的工作内存中清除，这样在 Synchronized 块内使用到该变量时就不会从线程的工作内存中获取，而是直接从主内存中获取。退出 Synchronized 块的内存语义是把在 Synchronized 块内对共享变量的修改刷新到主内存。</p>
<p>除可以解决共享变量内存可见性问题外，Synchronized 经常被用来实现原子性操作。</p>
<h4 id="Volatile-关键字"><a href="#Volatile-关键字" class="headerlink" title="Volatile 关键字"></a>Volatile 关键字</h4><p>Synchronized 锁太笨重，因为它会带来线程上下文的切换开销。对于解决内存可见性问题，Java 还提供了一种弱形式的同步，也就是使用 Volatile 关键字。该关键字可以确保对一个变量的更新对其他线程马上可见。当一个变量被声明为 Volatile 时，线程在写入变量时不会把值缓存在寄存器或其他地方，而是会把值刷新回主内存。当其他线程读取该共享变量时，会从主内存重新获取最新值，而不是使用当前线程的工作内存中的值。</p>
<p>Volatile 虽然提供了可见性保证，<strong>但并不保证操作的原子性。</strong></p>
<p>那么一般什么时候才使用 Volatile 关键字呢？</p>
<ul>
<li><p>写入变量值不依赖变量的当前值时。因为如果依赖当前值，将是获取——计算——写入三步操作，这三步操作不是原子性的，而 Volatile 不保证原子性。</p>
</li>
<li><p>读写变量值时没有加锁。因为加锁本身已经保证了内存可见性，这时候不需要把变量声明为 Volatile 的。</p>
</li>
</ul>
<h4 id="Java-中的-CAS-操作"><a href="#Java-中的-CAS-操作" class="headerlink" title="Java 中的 CAS 操作"></a>Java 中的 CAS 操作</h4><p>Java 提供的非阻塞的 volatile 关键字可以解决共享变量的可见性问题，但不能解决读——改——写等的原子性问题。CAS 即 Compare and Swap，其是 JDK 提供的非阻塞原子性操作。</p>
<p>CAS 操作有个经典的 ABA 问题，ABA 问题的产生是因为变量的状态值产生了环形转换，就是变量的值可以从 A 到 B，然后再从 B 到 A。如果变量的值只能朝一个方向转换，不构成环形，就不会存在问题。JDK 中的 AtomicStampedReference 类给每个变量的状态值都配备了一个时间戳，从而避免了 ABA 问题的产生。</p>
<h4 id="Unsafe-类"><a href="#Unsafe-类" class="headerlink" title="Unsafe 类"></a>Unsafe 类</h4><p>JDK 的 rt.jar 包中的 Unsafe 类提供了硬件级别的原子性操作，Unsafe 类中的方法都是 native 方法，它们使用 JNI 的方式访问本地 C++ 实现库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUnSafe</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取 Unsafe 的实例</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录变量 state 在类 TestUnSafe 中的偏移值</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> stateOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> state =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//获取 state 变量在类 TestUnSafe 中的偏移值</span></span><br><span class="line">            stateOffset = unsafe.objectFieldOffset(TestUnSafe.class.getDeclaredField(<span class="string">"state"</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println (e.getLocalizedMessage());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建实例，并且设置 state 值为1</span></span><br><span class="line">        TestUnSafe test = <span class="keyword">new</span> TestUnSafe();</span><br><span class="line"></span><br><span class="line">        Boolean sucess = unsafe.compareAndSwapInt(test, stateOffset, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(sucess);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码执行结果如下</p>
<p><img src="/2018/12/19/Java-并发编程之美学习笔记之基础篇二/images/pasted-99.png" alt="upload successful"></p>
<p>查看 Unsafe 源码</p>
<p><img src="/2018/12/19/Java-并发编程之美学习笔记之基础篇二/images/pasted-100.png" alt="upload successful"><br>代码判断是不是 Bootstrap 类加载器加载的 localClass，很明显 TestUnSafe.class 是使用 AppClassLoader 加载的，所以这里直接抛了异常。</p>
<p>如果真的想要实例化 Unsafe 类，可以使用反射来获取 Unsafe 类实例方法。</p>
<h4 id="Java指令重排序"><a href="#Java指令重排序" class="headerlink" title="Java指令重排序"></a>Java指令重排序</h4><p>Java 内存模型允许编译器和处理器对指令重排序以提高运行性能，并且只会对不存在数据依赖性的指令重排序。</p>
<p>重排序在多线程下会导致非预期的程序执行结果，而使用 volatile 修饰 ready 就可以避免重排序和内存可见性问题。</p>
<p>写 volatile 变量时，可以确保 volatile 写之前的操作不会被编译器重排序到 volatile 写之后。读 volatile 变量时，可以确保 volatile 读之后的操作不会被编译器重排序到 volatile 读之前。</p>
<p><strong>锁的概述</strong></p>
<p><strong>悲观锁</strong>指对数据被外界修改持保守态度，认为数据很容易就会被其它线程修改，所以在数据被处理前先对数据进行加锁，并在整个数据处理过程中，使数据处于锁定状态。</p>
<p><strong>乐观锁</strong>是相对悲观锁来说的，它认为数据在一般情况下不会造成冲突，所以在访问记录前不会加排它锁，而是在进行数据提交更新时，才会正式对数据冲突与否进行检测。</p>
<p>乐观锁并不会使用数据库提供的锁机制，一般在表中添加 version 字段或者使用业务状态来实现。乐观锁直到提交时才锁定，所以不会产生任何死锁。</p>
<p>根据线程获取锁的抢占机制，锁可以分为公平锁和非公平锁。<strong>公平锁</strong>表示线程获取锁的顺序是按照线程请求锁的时间早晚来决定的。而<strong>非公平锁</strong>则在运行时闯入。</p>
<p>在没有公平性需求的前提下尽量使用非公平锁，因为公平锁会带来性能开销。</p>
<p>根据锁只能被单个线程持有还是能被多个线程共同持有，锁可以分为独占锁和共享锁。<strong>独占锁</strong>是一种悲观锁，<strong>共享锁</strong>则是一种乐观锁。</p>
<p>Synchronized 内部锁是可重入锁。可重入锁的原理是在锁内部维护一个线程标示，用来标示该锁目前被哪个线程占用，然后关联一个计数器。一开始计数器值为0，说明该锁没有被任何线程占用。当一个线程获取了该锁时，计数器的值会变成1，这时其他线程再来获取该锁时会发现锁的所有者不是自己而被阻塞挂起。但是当获取了该锁的线程再次获取锁时发现锁拥有者是自己，就会把计数器值加1，当释放锁后计数器值-1.当计数器值为0时，锁里面的线程标示被重置为 null，这时候被阻塞的线程会被唤醒来竞争获取该锁。</p>
<p><strong>自旋锁</strong>当前线程在获取锁时，如果发现锁已经被其它线程占用，它不马上阻塞自己，在不放弃CPU使用权的情况下，多次尝试获取。自旋锁是使用CPU时间换取线程阻塞与调度的开销。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/18/Java-并发编程之美学习笔记之基础篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/18/Java-并发编程之美学习笔记之基础篇/" itemprop="url">Java 并发编程之美学习笔记之基础篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-18T14:48:00+08:00">
                2018-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p><img src="/2018/12/18/Java-并发编程之美学习笔记之基础篇/images/pasted-98.png" alt="upload successful"></p>
<p>多线程或并发编程是Java体系中的重点和难点，新购入 《Java 并发编程之美》，本博以笔记的形式记录知识要点。</p>
<hr>
<h4 id="并发编程线程基础"><a href="#并发编程线程基础" class="headerlink" title="并发编程线程基础"></a>并发编程线程基础</h4><h4 id="进程和线程关系"><a href="#进程和线程关系" class="headerlink" title="进程和线程关系"></a>进程和线程关系</h4><p>一个进程中有多个线程，多个线程共享进程的堆和方法区资源，但是每个线程有自己的程序计数器和栈区域。</p>
<p>程序计数器用来记录线程当前要执行的指令地址。</p>
<p>每个线程都有自己的栈资源，用于存储该线程的局部变量，这些局部变量是该线程私有的，其他线程是访问不了的，除此之外栈还用来存放线程的调用栈帧。</p>
<p>堆里面主要存放使用 new 操作创建的对象实例。</p>
<p>方法区用来存放 JVM 加载的类、常量及静态变量等信息，也是线程共享的。</p>
<h4 id="线程的创建与运行"><a href="#线程的创建与运行" class="headerlink" title="线程的创建与运行"></a>线程的创建与运行</h4><p>Java 中有三种线程创建方式，分别为实现 Runnable 接口的 run 方法，继承 Thread 类并重写 run 的方法，使用 FutureTask 方式。</p>
<p>使用<em>继承</em>方式的好处是：在 run 方法内获取当前线程直接使用 this 就可以了，无须使用 Thread.currrentThread() 方法。不好的地方是 Java 不支持多继承。另外任务与代码没有分离，当多个线程执行一样的任务时需要多份任务代码。而 Runnable 则没有这个限制。Runnable 只能使用主线程里面被声明为 final 的变量。</p>
<p>上面两种方式都有一个缺点，就是任务没有返回值。Futuretask 方式可以拿到返回值。</p>
<h4 id="线程通知与等待"><a href="#线程通知与等待" class="headerlink" title="线程通知与等待"></a>线程通知与等待</h4><p>当一个线程调用一个共享变量的 wait() 方法时，该调用线程会被阻塞挂起，直到发生下面几件事情之一才返回</p>
<ul>
<li>其他线程调用了该共享对象的 notify() 或 notifyAll() 方法。</li>
<li>其他线程调用了该线程的 interrupt()方法。</li>
<li>该线程抛出 InterruptedException 异常返回。</li>
</ul>
<p><strong><em>Note：</em></strong> 这里要注意的是区分<strong>共享对象</strong>和<strong>线程</strong></p>
<p>另外需要注意的是，如果调用 wait() 方法时没有事先获取该对象的监视器锁，则调用 wait() 方法时调用线程会抛出 IllegalMonitorStateException 异常。</p>
<p>当前线程调用 wait() 方法后只会释放<strong>当前共享变量</strong>上的锁，如果当前线程还持有其他<strong>共享变量</strong>的锁，则这些锁是不会被释放的。</p>
<h4 id="让线程睡眠的-sleep-方法"><a href="#让线程睡眠的-sleep-方法" class="headerlink" title="让线程睡眠的 sleep 方法"></a>让线程睡眠的 sleep 方法</h4><p>Thread 类中有一个静态的 sleep 方法，当一个执行中的线程调用了这个方法后，调用线程会暂时让出指定时间的执行权，也就是在这期间不参与CPU的调度，<strong>但是该线程所拥有的监视器资源，比如锁还是持有不让出的</strong></p>
<h4 id="让出-CPU-执行权的-yield-方法"><a href="#让出-CPU-执行权的-yield-方法" class="headerlink" title="让出 CPU 执行权的 yield 方法"></a>让出 CPU 执行权的 yield 方法</h4><p>Thread 类中有一个静态的 yield 方法，当一个线程调用 yield 方法时，当前线程会让出CPU使用权，然后处于就绪状态，线程调度器会从线程就绪队列里获取一个线程优先级最高的线程。</p>
<h4 id="线程死锁"><a href="#线程死锁" class="headerlink" title="线程死锁"></a>线程死锁</h4><p>死锁的产生必须具备以下四个条件</p>
<ul>
<li>互斥条件</li>
<li>请求并持有条件</li>
<li>不可剥夺条件</li>
<li>环路等待条件</li>
</ul>
<p>造成死锁的原因其实和申请资源的顺序有很大关系，使用资源申请的有序性原则就可以</p>
<h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><p>ThreadLocal 是 JDK 包提供的，它提供了线程本地变量，如果你创建了一个 ThreadLocal 变量，那么访问这个变量的每个线程都会有这个变量的一个本地副本。当多个线程操作这个变量时，实际操作的是本地内存里的变量，从而避免了线程安全问题。</p>
<p>ThreadLocal 不支持继承性</p>
<p>InheritableThreadLocal 类继承自 ThreadLocal 类，提供了一个特性，就是让子线程能访问到父线程中设置的本地变量。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/17/CV-计算机视觉学习笔记之滤波/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/17/CV-计算机视觉学习笔记之滤波/" itemprop="url">CV 计算机视觉学习笔记之滤波</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-17T13:30:00+08:00">
                2018-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CV/" itemprop="url" rel="index">
                    <span itemprop="name">CV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>噪声对图像处理的影响很大，它影响图像处理的输入、采集和处理等各个环节以及输出结果。因此，在进行其它的图像处理前，需要对图像进行去噪处理。</p>
<p>从统计学的观点来看，凡是统计特征不随时间变化的噪声称为平稳噪声，而统计特征随时间变化的噪声称为非平稳噪声。幅值基本相同，但是噪声出现的位置是随机的，称为椒盐噪声；如果噪声的幅值是随机的，根据幅值大小的分布，有高斯型和瑞利型两种，分别称为高斯噪声和瑞利噪声。</p>
<p><strong>椒盐噪声</strong>：出现位置是随机的，但噪声的幅值是基本相同的。<br><strong>高斯噪声</strong>：出现位置是固定的（每一点），但噪声的幅值是随机的。</p>
<p>常见的去噪处理有均值滤波，中值滤波，灰度最小方差均值滤波，K近邻平滑滤波，对称近邻均值滤波，西戈玛平滑滤波等。</p>
<h4 id="均值滤波"><a href="#均值滤波" class="headerlink" title="均值滤波"></a>均值滤波</h4><p>均值滤波器可以归为低通滤波器，是一种线性滤波器，其输出为邻域模板内的像素的简单平均值，主要用于图像的模糊和降噪。</p>
<p>均值滤波器的概念非常的直观，使用滤波器窗口内的像素的平均灰度值代替图像中的像素值，这样的结果就是降低图像中的“尖锐”变化。这就造成，均值滤波器可以降低噪声的同时，也会模糊图像的边缘。均值滤波器的处理结果是过滤掉图像中的“不相关”细节，其中“不相关”细节指的是：与滤波器模板尺寸相比较小的像素区域。</p>
<p><strong>权系数矩阵模板</strong></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-87.png" alt="upload successful"></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-88.png" alt="upload successful"></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-96.png" alt="upload successful"></p>
<p><strong>优点：</strong> 算法简单，计算速度快；</p>
<p><strong>缺点：</strong> 它不能很好地保护图像细节，在图像去噪的同时也破坏了图像的细节部分，从而使图像变得模糊，不能很好地去除噪声点。</p>
<h4 id="中值滤波"><a href="#中值滤波" class="headerlink" title="中值滤波"></a>中值滤波</h4><p>中值滤波也是消除图像噪声最常见的手段之一，特别是消除椒盐噪声，中值滤波的效果要比均值滤波更好。中值滤波是跟均值滤波唯一不同是，不是用均值来替换中心每个像素，而是将周围像素和中心像素排序以后，取中值。</p>
<p>中值滤波的设计思想：因为噪声的出现（如椒盐噪声），使改点的像素比周围的像素亮（暗）许多，那么对像素点周围的像素进行由小到大的排列后，最明或最暗的像素一定是排在两边。取排在中间位置上像素值的灰度值替换待处理像素值，就可以达到去除噪声的目的。</p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-95.png" alt="upload successful"></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-89.png" alt="upload successful"></p>
<p>左边是添加概率为0.2的椒盐噪声，右边是原图。下面是使用常规的中值滤波和自适应中值滤波器后的处理结果</p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-90.png" alt="upload successful"></p>
<h4 id="高斯滤波"><a href="#高斯滤波" class="headerlink" title="高斯滤波"></a>高斯滤波</h4><p>高斯滤波器是一种线性滤波器，能够有效的抑制噪声，平滑图像。其作用原理和均值滤波器类似，都是取滤波器窗口内的像素的均值作为输出。其窗口模板的系数和均值滤波器不同，均值滤波器的模板系数都是相同的为1；而高斯滤波器的模板系数，则随着距离模板中心的增大而系数减小。所以，高斯滤波器相比于均值滤波器对图像个模糊程度较小。</p>
<p>模拟人眼，关注中心区域，有效去除高斯噪声。</p>
<p><strong>权系数矩阵模板</strong><br><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-92.png" alt="upload successful"></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-97.png" alt="upload successful"></p>
<p><img src="/2018/12/17/CV-计算机视觉学习笔记之滤波/images/pasted-94.png" alt="upload successful"></p>
<hr>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p><a href="https://blog.csdn.net/luoweifu/article/details/8150196" target="_blank" rel="noopener">图像噪声的抑制——均值滤波、中值滤波、对称均值滤波</a></p>
<p><a href="https://www.cnblogs.com/wangguchangqing/p/6379646.html" target="_blank" rel="noopener">图像处理基础(2)：自适应中值滤波器(基于OpenCV实现)</a></p>
<p><a href="http://www.php-master.com/post/326349.html" target="_blank" rel="noopener">Python-OpenCV——进阶操作一网打尽</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/15/Docker-下安装配置-Cloud9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/15/Docker-下安装配置-Cloud9/" itemprop="url">Docker 下安装配置 Cloud9</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-15T21:14:00+08:00">
                2018-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="安装配置-Cloud9-的原因"><a href="#安装配置-Cloud9-的原因" class="headerlink" title="安装配置 Cloud9 的原因"></a>安装配置 Cloud9 的原因</h4><p>日常工作中可能需要使用 Web IDE 进行代码展示或存储，经过查询，Eclipse Che 和 Cloud9 是两款优秀的 Web IDE，先选择 Cloud9 进行安装试用。</p>
<p>在寻找 Docker 仓库中发现了 kdelfour/cloud9-docker，试用过程中发现下列几个问题</p>
<ul>
<li>没有安装 JDK，不能进行 Java 代码编译运行</li>
<li>系统是 Ubuntu 14.04.2 LTS</li>
<li>默认端口号是 80</li>
</ul>
<p>为了解决这些问题，开始搭建符合自己需求的 Cloud9 容器</p>
<h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><h5 id="一-安装-Docker-CE-（社区版）"><a href="#一-安装-Docker-CE-（社区版）" class="headerlink" title="一.  安装 Docker CE （社区版）"></a>一.  安装 Docker CE （社区版）</h5><ol>
<li>Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the devicemapper storage driver.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils  device-mapper-persistent-data  lvm2</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Use the following command to set up the stable repository. You always need the stable repository, even if you want to install builds from the edge or test repositories as well.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Install the latest version of Docker CE, or go to the next step to install a specific version:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Start Docker and check docker version</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure>
<h5 id="二-获取-centos7-容器的镜像"><a href="#二-获取-centos7-容器的镜像" class="headerlink" title="二. 获取 centos7 容器的镜像"></a>二. 获取 centos7 容器的镜像</h5><ol>
<li>配置国内镜像仓库</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"DOCKER_OPTS=\"--registry-mirror=http://hub-mirror.c.163.com\""</span> &gt;&gt; /etc/default/docker</span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>查找 centos7 镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search centos</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>下载镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>
<h5 id="三-安装-OpenJDK"><a href="#三-安装-OpenJDK" class="headerlink" title="三. 安装 OpenJDK"></a>三. 安装 OpenJDK</h5><ol>
<li><p>启动 centos 容器</p>
<p>–network=host 让容器使用主机的 IP 地址<br>-v  配置路径  workspace 是 cloud9 将要使用的路径</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name cloud9 --network=host -v /data/workspace/:/workspace/ centos</span><br><span class="line">docker <span class="built_in">exec</span> -it cloud9 bash</span><br><span class="line">yum update</span><br><span class="line">yum -y install <span class="built_in">which</span></span><br><span class="line">yum -y install java-1.8.0-openjdk java-1.8.0-openjdk-devel</span><br><span class="line">    </span><br><span class="line">cat &gt; /etc/profile.d/java8.sh &lt;&lt;EOF </span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=$(dirname $(dirname $(readlink $(readlink $(<span class="built_in">which</span> javac)))))</span><br><span class="line"><span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:\<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:\<span class="variable">$JAVA_HOME</span>/jre/lib:\<span class="variable">$JAVA_HOME</span>/lib:\<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">EOF</span><br><span class="line">  </span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/java8.sh</span><br></pre></td></tr></table></figure>
<h5 id="四-安装编译-Cloud9"><a href="#四-安装编译-Cloud9" class="headerlink" title="四. 安装编译 Cloud9"></a>四. 安装编译 Cloud9</h5><ol>
<li>安装编译环境</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y build-essential g++ curl libssl-dev apache2-utils git libxml2-dev sshfs</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装 Node.js</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://rpm.nodesource.com/setup_11.x | bash -</span><br><span class="line">yum install -y nodejs</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>安装 Cloud9</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/c9/core.git /cloud9</span><br><span class="line"><span class="built_in">cd</span> /cloud9</span><br><span class="line">scripts/install-sdk.sh</span><br><span class="line">    </span><br><span class="line">mkdir -p /etc/supervisor/conf.d/</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>配置 cloud9.conf 文件</li>
</ol>
<pre><code>vi /etc/supervisor/conf.d/cloud9.conf


[program:cloud9]
command = node /cloud9/server.js --listen 0.0.0.0 --port 80 -w /workspace
directory = /cloud9
user = root
autostart = true
autorestart = true
stdout_logfile = /var/log/supervisor/cloud9.log
stderr_logfile = /var/log/supervisor/cloud9_errors.log
environment = NODE_ENV=&quot;production&quot;
</code></pre><p> node 启动参数说明：</p>
<blockquote>
<p>–settings Settings file to use 设置启动配置文件<br>–help Show command line options.帮助<br>-t Start in test mode 启动测试模式<br>-k Kill tmux server in test mode 在测试模式中杀死tmux终端<br>-b Start the bridge server - to receive commands from the cli [default: false]<br>-w Workspace directory 设置工作目录<br>–port Port 端口号<br>–debug Turn debugging on 启动调试模式<br>–listen IP address of the server 侦听ip，默认应该是0.0.0.0<br>–readonly Run in read only mode 只读模式，不能进行修改文件等操作<br>–packed Whether to use the packed version. 使用打包好的版本<br>–auth Basic Auth username:password 登陆时时使用http auth认证 设置用户名密码<br>–collab Whether to enable collab. 是否设置collab<br>–no-cache Don’t use the cached version of CSS 不进行缓存</p>
</blockquote>
<ol start="5">
<li>设置自启动</li>
</ol>
<p><a href="http://supervisord.org" target="_blank" rel="noopener">Supervisor</a> 是一个用 Python 写的进程管理工具，可以很方便的用来启动、重启、关闭进程（不仅仅是 Python 进程）。除了对单个进程的控制，还可以同时启动、关闭多个进程，比如很不幸的服务器出问题导致所有应用程序都被杀死，此时可以用 supervisor 同时启动所有应用程序而不是一个一个地敲命令启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools -y</span><br><span class="line">easy_install supervisor</span><br></pre></td></tr></table></figure>
<h4 id="启动界面"><a href="#启动界面" class="headerlink" title="启动界面"></a>启动界面</h4><p><img src="/2018/12/15/Docker-下安装配置-Cloud9/images/pasted-85.png" alt="upload successful"></p>
<p><img src="/2018/12/15/Docker-下安装配置-Cloud9/images/pasted-86.png" alt="upload successful"></p>
<hr>
<p>Supervisor 安装与配置可参考：</p>
<p><a href="http://supervisord.org/introduction.html" target="_blank" rel="noopener">Supervisord 官网</a></p>
<p><a href="https://blog.csdn.net/xyang81/article/details/51555473" target="_blank" rel="noopener">Supervisor安装与配置</a></p>
<p><a href="http://liyangliang.me/posts/2015/06/using-supervisor/" target="_blank" rel="noopener">使用 supervisor 管理进程</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/12/Java-类加载器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/12/Java-类加载器/" itemprop="url">Java 类加载器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-12T15:32:00+08:00">
                2018-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、类加载机制"><a href="#一、类加载机制" class="headerlink" title="一、类加载机制"></a>一、类加载机制</h3><p>当程序主动使用某个类时，如果该类还未被加载到内存中，则系统会通过加载、连接、初始化三个步骤来对该类进行初始化</p>
<p><img src="/2018/12/12/Java-类加载器/images/pasted-83.png" alt="upload successful"></p>
<p><strong>a. 加载</strong></p>
<p>加载是类加载过程中的一个阶段，这个阶段会在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的入口。注意这里不一定非得要从一个Class文件获取，这里既可以从ZIP包中读取（比如从jar包和war包中读取），也可以在运行时计算生成（动态代理），也可以由其它文件生成（比如将JSP文件转换成对应的Class类）。</p>
<p><strong>b. 验证</strong></p>
<p>这一阶段的主要目的是为了确保Class文件的字节流中包含的信息是否符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。主要包括四种验证，</p>
<ul>
<li>文件格式验证：验证字节流是否符合Class文件格式的规范，并且能被当前版本的虚拟机处理，该验证的主要目的是保证输入的字节流能正确地解析并存储于方法区之内。经过该阶段的验证后，字节流才会进入内存的方法区中进行存储，后面的三个验证都是基于方法区的存储结构进行的。</li>
<li>元数据验证：对类的元数据信息进行语义校验（其实就是对类中的各数据类型进行语法校验），保证不存在不符合Java语法规范的元数据信息。</li>
<li>字节码验证：该阶段验证的主要工作是进行数据流和控制流分析，对类的方法体进行校验分析，以保证被校验的类的方法在运行时不会做出危害虚拟机安全的行为。</li>
<li>符号引用验证：这是最后一个阶段的验证，它发生在虚拟机将符号引用转化为直接引用的时候（解析阶段中发生该转化，后面会有讲解），主要是对类自身以外的信息（常量池中的各种符号引用）进行匹配性的校验。</li>
</ul>
<p><strong>c. 准备</strong></p>
<p>准备阶段是正式为类变量分配内存并设置类变量的初始值阶段，即在方法区中分配这些变量所使用的内存空间。注意这里所说的初始值概念，比如一个类变量定义为：</p>
<p>public static int v = 8080;<br>实际上变量v在准备阶段过后的初始值为0而不是8080，将v赋值为8080的putstatic指令是程序被编译后，存放于类构造器<client>方法之中，这里我们后面会解释。<br>但是注意如果声明为：</client></p>
<p>public static final int v = 8080;<br>在编译阶段会为v生成ConstantValue属性，在准备阶段虚拟机会根据ConstantValue属性将v赋值为8080。</p>
<p><strong>d. 解析</strong></p>
<p>解析阶段是指虚拟机将常量池中的符号引用替换为直接引用的过程。符号引用就是class文件中的：</p>
<p>CONSTANT_Class_info<br>CONSTANT_Field_info<br>CONSTANT_Method_info<br>等类型的常量。</p>
<p>下面我们解释一下符号引用和直接引用的概念：</p>
<p>符号引用与虚拟机实现的布局无关，引用的目标并不一定要已经加载到内存中。各种虚拟机实现的内存布局可以各不相同，但是它们能接受的符号引用必须是一致的，因为符号引用的字面量形式明确定义在Java虚拟机规范的Class文件格式中。<br>直接引用可以是指向目标的指针，相对偏移量或是一个能间接定位到目标的句柄。如果有了直接引用，那引用的目标必定已经在内存中存在。</p>
<p><strong>e. 初始化</strong></p>
<p>初始化阶段是类加载最后一个阶段，前面的类加载阶段之后，除了在加载阶段可以自定义类加载器以外，其它操作都由JVM主导。到了初始阶段，才开始真正执行类中定义的Java程序代码。</p>
<p>初始化阶段是执行类构造器<client>方法的过程。<client>方法是由编译器自动收集类中的类变量的赋值操作和静态语句块中的语句合并而成的。虚拟机会保证<client>方法执行之前，父类的<client>方法已经执行完毕。p.s: 如果一个类中没有对静态变量赋值也没有静态语句块，那么编译器可以不为这个类生成<client>()方法。</client></client></client></client></client></p>
<h3 id="类初始化的时机"><a href="#类初始化的时机" class="headerlink" title="类初始化的时机"></a>类初始化的时机</h3><p>当Java程序首次通过下面的 6种 方式来使用某个类或接口时，系统就会初始化该类或接口，也称为主动初始化。<br>触发类加载的条件：</p>
<ol>
<li>创建类的实例。<ul>
<li>使用 new 来创建实例</li>
<li>通过反射创建实例</li>
<li>通过反序列化来创建实例</li>
</ul>
</li>
<li>调用类的类变量（静态属性），或为该类变量赋值。</li>
<li>调用类的静态方法。</li>
<li>通过class文件反射创建对象。<br>例如：Class.forName(“Person”);</li>
<li>初始化一个子类的时候，该子类的所有父类都会被初始化。</li>
<li>java虚拟机启动时被标记为启动类的类，就是 main 方法所在的类。</li>
</ol>
<p><em>注意以下几种情况不会执行类初始化：</em></p>
<ul>
<li>通过子类引用父类的静态字段，只会触发父类的初始化，而不会触发子类的初始化。</li>
<li>定义对象数组，不会触发该类的初始化。</li>
<li>常量在编译期间会存入调用类的常量池中，本质上并没有直接引用定义常量的类，不会触发定义常量所在的类。</li>
<li>通过类名获取Class对象，不会触发类的初始化。</li>
<li>通过Class.forName加载指定类时，如果指定参数initialize为false时，也不会触发类初始化，其实这个参数是告诉虚拟机，是否要对类进行初始化。</li>
<li>通过ClassLoader默认的loadClass方法，也不会触发初始化动作。</li>
<li>在编译时能够确定下来的 final修饰的静态变量（编译常量）不会对类进行初始化。</li>
<li>在编译时无法确定下来的 final修饰的静态变量（运行时常量）会对类进行初始化。</li>
</ul>
<h3 id="二-类加载器"><a href="#二-类加载器" class="headerlink" title="二. 类加载器"></a>二. 类加载器</h3><p>类加载器（class loader）用来加载 Java 类到 Java 虚拟机中。一般来说，Java 虚拟机使用 Java 类的方式如下：Java 源程序（.java 文件）在经过 Java 编译器编译之后就被转换成 Java 字节代码（.class 文件）。类加载器负责读取 Java 字节代码，并转换成 java.lang.Class类的一个实例。每个这样的实例用来表示一个 Java 类。通过此实例的 newInstance()方法就可以创建出该类的一个对象。</p>
<p>基本上所有的类加载器都是 java.lang.ClassLoader类的一个实例。</p>
<p><strong>java.lang.ClassLoader类介绍</strong></p>
<p>java.lang.ClassLoader类的基本职责就是根据一个指定的类的名称，找到或者生成其对应的字节代码，然后从这些字节代码中定义出一个 Java 类，即 java.lang.Class类的一个实例。除此之外，ClassLoader还负责加载 Java 应用所需的资源，如图像文件和配置文件等。</p>
<p><strong>类加载器的树状组织结构</strong></p>
<p>Java 中的类加载器大致可以分成两类，一类是系统提供的，另外一类则是由 Java 应用开发人员编写的。系统提供的类加载器主要有下面三个：</p>
<ul>
<li>引导类加载器（bootstrap class loader）：它用来加载 Java 的核心库，是用原生代码来实现的，并不继承自 java.lang.ClassLoader。</li>
<li>扩展类加载器（extensions class loader）：它用来加载 Java 的扩展库。Java 虚拟机的实现会提供一个扩展库目录（JAVA_HOME/jre/ext/*.jar或java.ext.dirs路径下的内容）。该类加载器在此目录里面查找并加载 Java 类。由sun.misc.Launcher$ExtClassLoader实现</li>
<li>系统类加载器（system class loader）：它根据 Java 应用的类路径（CLASSPATH）来加载 Java 类。一般来说，Java 应用的类都是由它来完成加载的。可以通过 ClassLoader.getSystemClassLoader()来获取它。由sun.misc.Launcher$AppClassLoader实现</li>
</ul>
<p>除了系统提供的类加载器以外，开发人员可以通过继承 java.lang.ClassLoader类的方式实现自己的类加载器，以满足一些特殊的需求。</p>
<p>除了引导类加载器之外，所有的类加载器都有一个父类加载器。通过 表 1中给出的 getParent()方法可以得到。对于系统提供的类加载器来说，系统类加载器的父类加载器是扩展类加载器，而扩展类加载器的父类加载器是引导类加载器；对于开发人员编写的类加载器来说，其父类加载器是加载此类加载器 Java 类的类加载器。因为类加载器 Java 类如同其它的 Java 类一样，也是要由类加载器来加载的。一般来说，开发人员编写的类加载器的父类加载器是系统类加载器。类加载器通过这种方式组织起来，形成树状结构。树的根节点就是引导类加载器。图 1中给出了一个典型的类加载器树状组织结构示意图，其中的箭头指向的是父类加载器。</p>
<p>图 1. 类加载器树状组织结构示意图</p>
<p><img src="/2018/12/12/Java-类加载器/images/pasted-84.png" alt="upload successful"></p>
<p>代码清单 1演示了类加载器的树状组织结构。</p>
<p>清单 1. 演示类加载器的树状组织结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTree</span> </span>&#123; </span><br><span class="line"></span><br><span class="line"> 	 <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">     	 ClassLoader loader = ClassLoaderTree.class.getClassLoader(); </span><br><span class="line">        <span class="keyword">while</span> (loader != <span class="keyword">null</span>) &#123; </span><br><span class="line">            System.out.println(loader.toString()); </span><br><span class="line">            loader = loader.getParent(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="类加载器的代理模式"><a href="#类加载器的代理模式" class="headerlink" title="类加载器的代理模式"></a>类加载器的代理模式</h3><p>类加载器在尝试自己去查找某个类的字节代码并定义它时，会先代理给其父类加载器，由父类加载器先去尝试加载这个类，依次类推。在介绍代理模式背后的动机之前，首先需要说明一下 Java 虚拟机是如何判定两个 Java 类是相同的。Java 虚拟机不仅要看类的全名是否相同，还要看加载此类的类加载器是否一样。只有两者都相同的情况，才认为两个类是相同的。即便是同样的字节代码，被不同的类加载器加载之后所得到的类，也是不同的。比如一个 Java 类 com.example.Sample，编译之后生成了字节代码文件 Sample.class。两个不同的类加载器 ClassLoaderA和 ClassLoaderB分别读取了这个 Sample.class文件，并定义出两个 java.lang.Class类的实例来表示这个类。这两个实例是不相同的。对于 Java 虚拟机来说，它们是不同的类。试图对这两个类的对象进行相互赋值，会抛出运行时异常 ClassCastException。</p>
<p>了解了这一点之后，就可以理解代理模式的设计动机了。代理模式是为了保证 Java 核心库的类型安全。所有 Java 应用都至少需要引用 java.lang.Object类，也就是说在运行的时候，java.lang.Object这个类需要被加载到 Java 虚拟机中。如果这个加载过程由 Java 应用自己的类加载器来完成的话，很可能就存在多个版本的 java.lang.Object类，而且这些类之间是不兼容的。通过代理模式，对于 Java 核心库的类的加载工作由引导类加载器来统一完成，保证了 Java 应用所使用的都是同一个版本的 Java 核心库的类，是互相兼容的。</p>
<p>不同的类加载器为相同名称的类创建了额外的名称空间。相同名称的类可以并存在 Java 虚拟机中，只需要用不同的类加载器来加载它们即可。不同类加载器加载的类之间是不兼容的，这就相当于在 Java 虚拟机内部创建了一个个相互隔离的 Java 类空间。</p>
<h3 id="加载类的过程"><a href="#加载类的过程" class="headerlink" title="加载类的过程"></a>加载类的过程</h3><p>在前面介绍类加载器的代理模式的时候，提到过类加载器会首先代理给其它类加载器来尝试加载某个类。这就意味着真正完成类的加载工作的类加载器和启动这个加载过程的类加载器，有可能不是同一个。真正完成类的加载工作是通过调用 defineClass来实现的；而启动类的加载过程是通过调用 loadClass来实现的。前者称为一个类的定义加载器（defining loader），后者称为初始加载器（initiating loader）。在 Java 虚拟机判断两个类是否相同的时候，使用的是类的定义加载器。也就是说，哪个类加载器启动类的加载过程并不重要，重要的是最终定义这个类的加载器。两种类加载器的关联之处在于：一个类的定义加载器是它引用的其它类的初始加载器。如类 com.example.Outer引用了类 com.example.Inner，则由类 com.example.Outer的定义加载器负责启动类 com.example.Inner的加载过程。</p>
<p>方法 loadClass()抛出的是 java.lang.ClassNotFoundException异常；方法 defineClass()抛出的是 java.lang.NoClassDefFoundError异常。</p>
<p>类加载器在成功加载某个类之后，会把得到的 java.lang.Class类的实例缓存起来。下次再请求加载该类的时候，类加载器会直接使用缓存的类的实例，而不会尝试再次加载。也就是说，对于一个类加载器实例来说，相同全名的类只加载一次，即 loadClass方法不会被重复调用。</p>
<h3 id="线程上下文类加载器"><a href="#线程上下文类加载器" class="headerlink" title="线程上下文类加载器"></a>线程上下文类加载器</h3><p>线程上下文类加载器（context class loader）是从 JDK 1.2 开始引入的。类 java.lang.Thread中的方法 getContextClassLoader()和 setContextClassLoader(ClassLoader cl)用来获取和设置线程的上下文类加载器。如果没有通过 setContextClassLoader(ClassLoader cl)方法进行设置的话，线程将继承其父线程的上下文类加载器。Java 应用运行的初始线程的上下文类加载器是系统类加载器。在线程中运行的代码可以通过此类加载器来加载类和资源。</p>
<p>前面提到的类加载器的代理模式并不能解决 Java 应用开发中会遇到的类加载器的全部问题。Java 提供了很多服务提供者接口（Service Provider Interface，SPI），允许第三方为这些接口提供实现。常见的 SPI 有 JDBC、JCE、JNDI、JAXP 和 JBI 等。这些 SPI 的接口由 Java 核心库来提供，如 JAXP 的 SPI 接口定义包含在 javax.xml.parsers包中。这些 SPI 的实现代码很可能是作为 Java 应用所依赖的 jar 包被包含进来，可以通过类路径（CLASSPATH）来找到，如实现了 JAXP SPI 的 Apache Xerces所包含的 jar 包。SPI 接口中的代码经常需要加载具体的实现类。如 JAXP 中的 javax.xml.parsers.DocumentBuilderFactory类中的 newInstance()方法用来生成一个新的 DocumentBuilderFactory的实例。这里的实例的真正的类是继承自 javax.xml.parsers.DocumentBuilderFactory，由 SPI 的实现所提供的。如在 Apache Xerces 中，实现的类是 org.apache.xerces.jaxp.DocumentBuilderFactoryImpl。而问题在于，SPI 的接口是 Java 核心库的一部分，是由引导类加载器来加载的；SPI 实现的 Java 类一般是由系统类加载器来加载的。引导类加载器是无法找到 SPI 的实现类的，因为它只加载 Java 的核心库。它也不能代理给系统类加载器，因为它是系统类加载器的祖先类加载器。也就是说，类加载器的代理模式无法解决这个问题。</p>
<p>线程上下文类加载器正好解决了这个问题。如果不做任何的设置，Java 应用的线程的上下文类加载器默认就是系统上下文类加载器。在 SPI 接口的代码中使用线程上下文类加载器，就可以成功的加载到 SPI 实现的类。线程上下文类加载器在很多 SPI 的实现中都会用到。</p>
<h3 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName"></a>Class.forName</h3><p>Class.forName是一个静态方法，同样可以用来加载类。该方法有两种形式：Class.forName(String name, boolean initialize, ClassLoader loader)和 Class.forName(String className)。第一种形式的参数 name表示的是类的全名；initialize表示是否初始化类；loader表示加载时使用的类加载器。第二种形式则相当于设置了参数 initialize的值为 true，loader的值为当前类的类加载器。Class.forName的一个很常见的用法是在加载数据库驱动的时候。如 Class.forName(“org.apache.derby.jdbc.EmbeddedDriver”).newInstance()用来加载 Apache Derby 数据库的驱动。</p>
<hr>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html" target="_blank" rel="noopener">深入探讨 Java 类加载器</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/07/Anaconda-下安装-pyecharts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/07/Anaconda-下安装-pyecharts/" itemprop="url">Anaconda 下安装 pyecharts</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-07T16:40:00+08:00">
                2018-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>克隆github库安装</strong></p>
<p>因为我的系统里同时安装了 python2 python3，所以安装 pyecharts 颇费周折</p>
<pre><code>git clone https://github.com/pyecharts/pyecharts.git
cd pyecharts
pip3 install -r requirements.txt
python3 setup.py install
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/12/06/RNN-and-LSTM-转/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/RNN-and-LSTM-转/" itemprop="url">RNN and LSTM (转)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T13:29:00+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Deep Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文见  杨健程  <a href="https://www.slideshare.net/ssuser6c624f/understanding-rnn-and-lstm" target="_blank" rel="noopener">RNN and LSTM </a></p>
<p>本处引用仅供学习使用</p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-70.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-71.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-72.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-73.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-74.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-75.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-76.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-77.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-78.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-79.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-80.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-81.png" alt="upload successful"></p>
<p><img src="/2018/12/06/RNN-and-LSTM-转/images/pasted-82.png" alt="upload successful"></p>
<hr>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p><a href="http://www.wildml.com/2015/10/recurrent-neural-networks-tutorial-part-3-backpropagation-through-time-and-vanishing-gradients/" target="_blank" rel="noopener">Recurrent Neural Networks Tutorial</a></p>
<p><a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/" target="_blank" rel="noopener">Understanding LSTM Networks</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/11/13/jupyter-notebook-与-Nginx-集成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/13/jupyter-notebook-与-Nginx-集成/" itemprop="url">jupyter notebook 与 Nginx 集成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-13T14:55:00+08:00">
                2018-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-配置-jupyter-notebook"><a href="#1-配置-jupyter-notebook" class="headerlink" title="1. 配置 jupyter notebook"></a>1. 配置 jupyter notebook</h4><pre><code>vim /roo/.jupyter/jupyter_notebook_config.py
</code></pre><p>编辑 C.NotebookApp.base_url </p>
<p><img src="/2018/11/13/jupyter-notebook-与-Nginx-集成/images/pasted-69.png" alt="upload successful"></p>
<p><strong> 注意：这里一定要给个路径，不能直接使用 / 作为路径！原因是 nginx 需要根据路径进行解析，如果使用 / 作为路径，nginx的配置会非常麻烦</strong></p>
<h4 id="2-配置-Nginx"><a href="#2-配置-Nginx" class="headerlink" title="2. 配置 Nginx"></a>2. 配置 Nginx</h4><pre><code>        location ^~ /ipython/ {
        proxy_pass  http://www.domain.com:port;     
        proxy_set_header    Referer   http://www.isaac-li.com:9527;  
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade &quot;websocket&quot;;
        proxy_set_header Connection &quot;Upgrade&quot;;
        proxy_read_timeout 86400;
        proxy_redirect off;

    }


    location ~* /(api/kernels/[^/]+/(channels|iopub|shell|stdin)|terminals/websocket)/? {
       proxy_pass  http://www.domain.com:port;
       proxy_set_header    Referer   http://www.isaac-li.com:9527;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade &quot;websocket&quot;;
        proxy_set_header Connection &quot;Upgrade&quot;;
        proxy_read_timeout 86400;
        proxy_redirect off;
} 
</code></pre><p><a href="http://www.domain.com:port" target="_blank" rel="noopener">www.domain.com:port</a> 需要根据实际情况换成自己的域名和端口号，端口号为 jupyter notebook 服务端口</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/11/13/Nginx-配置问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/13/Nginx-配置问题/" itemprop="url">Nginx 配置问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-13T13:19:00+08:00">
                2018-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在配置Nginx时遇到了一类配置问题，这类问题很容易被忽略，但是影响很大</p>
<p>在proxy_pass 配置里 URL路径最后是否有 / 直接影响了 Nginx 的解析路径，要特别注意。</p>
<pre><code>location /proxy/ {
    proxy_pass http://127.0.0.1/;
}
代理到URL：http://127.0.0.1/

location /proxy/ {
    proxy_pass http://127.0.0.1;
}
代理到URL：http://127.0.0.1/proxy/
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Isaac-Li.github.io/2018/11/06/Hexo-与-Nginx-的集成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Li">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/06/Hexo-与-Nginx-的集成/" itemprop="url">Hexo 与 Nginx 的集成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-06T10:59:00+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用 Hexo 时最麻烦的事情应该是贴图了，问题主要出现在如何把图片的网络请求路径解析成实际存储路径这个过程中。本文记录了使用 Nginx 集成 Hexo 解决图片显示问题的技术步骤。</p>
<p><strong>1. 编辑 Post</strong></p>
<p>使用 Hexo Admin 插件进行 Post 编辑时直接可以直接使用 Ctrl+C/Ctrl+V 贴图，成功后会有如下信息</p>
<p><img src="/2018/11/06/Hexo-与-Nginx-的集成/images/pasted-67.png" alt="upload successful"><br>这时图片是存放在 Hexo目录下的子目录 Source/images 目录中</p>
<p><strong>2. 发布 Post</strong></p>
<p>使用 Hexo g 命令发布 Post，这时图片会存在 Hexo目录下的子目录 public/images 目录中</p>
<p><strong>3. 配置 Nginx</strong></p>
<p>根据 Hexo Admin 插件命名图片的格式，在 nginx.conf 文件中配置如下，把 png 类型的图片请求路径映射到 public/images/目录下</p>
<p><img src="/2018/11/06/Hexo-与-Nginx-的集成/images/pasted-68.png" alt="upload successful"></p>
<p>上述方法实测有效。现在发布 Post，只需要运行 Hexo g 命令即可。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Isaac Li" />
            
              <p class="site-author-name" itemprop="name">Isaac Li</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Isaac-Li" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lee_isaac@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.deeplearning.ai/" title="deeplearning.ai" target="_blank">deeplearning.ai</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ai-start.com/" title="AI初学者" target="_blank">AI初学者</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.fast.ai/" title="fast.ai" target="_blank">fast.ai</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.ibm.com/developerworks/cn/" title="IBM Developer" target="_blank">IBM Developer</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.odi.ch/prog/design/newbies.php" title="Java Anti-Patterns" target="_blank">Java Anti-Patterns</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://timdettmers.com/" title="Tim Dettmers's blog" target="_blank">Tim Dettmers's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://colah.github.io/" title="colash's blog" target="_blank">colash's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com/blog/" title="阮一峰的网络日志" target="_blank">阮一峰的网络日志</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://dylandjian.github.io/" title="Dylan's blog" target="_blank">Dylan's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://shartoo.github.io/" title="shartoo's blog" target="_blank">shartoo's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dataquest.io/blog/" title="DATAQUEST" target="_blank">DATAQUEST</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://cmsblogs.com/" title="Java技术驿站" target="_blank">Java技术驿站</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.w3schools.com/default.asp" title="w3schools" target="_blank">w3schools</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://tool.oschina.net/regex" title="在线正则表达式测试" target="_blank">在线正则表达式测试</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Isaac Li</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
